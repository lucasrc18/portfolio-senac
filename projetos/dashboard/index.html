<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;400;600&display=swap" rel="stylesheet">
    <!-- Inter -->

    <link rel="stylesheet" href="./styles/main.css">
</head>

<body>
    <main>
        <section id="small-elements" class="status-0">
            <p class="empty-message">Adicione elementos clicando em <img class="small-icon" src="./assets/add.svg"
                    alt="Icone de adicionar elemento" /></p>

            <table id="el-table">
            </table>
        </section>

        <section id="main-elements" class="status-1">
            <p class="empty-message">Adicione elementos de destaque clicando em <img class="small-icon"
                    src="./assets/add.svg" alt="Icone de adicionar elemento" /></p>

            <div>
                <canvas></canvas>
            </div>
        </section>
    </main>

    <aside>
        <div><img src="./assets/add.svg" alt="Adicionar elemento" id="addElement" /></div>
        <div><img src="./assets/edit.svg" alt="Adicionar elemento" /></div>
        <div><img src="./assets/trash.svg" alt="Deletar element" /></div>
    </aside>

    <div id="modal-bg" class="active">
        <div id="modal">
            <form action="" method="post">
                <section>
                    <label for="el_selector">Qual gráfico:</label>
                    <select name="el_selector" id="el_selector">
                        <option value="-1">Escolha um tipo de elemento:</option>
                    </select>
                </section>

                <div id="not-selected" class="sel">
                    Nenhuma opção selecionada!
                </div>

                <div id="single-param">
                    <div class="data-title">
                        <p title="Titulo do dado" class="graphic_type" contenteditable><i>...</i></p>
                    </div>

                    <div id="data-input1">
                        <label for="1param_i">Digite os dados:</label><br />
                        <input type="number" name="1param_i" id="1param_i" placeholder="Ex. 123" />
                        <button type="button" class="add-data-btn b1">Adicionar!</button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th colspan="2">Dados inseridos:</th>
                            </tr>
                            <tr>
                                <th>N.</th>
                                <th>Valor:</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                        <tfoot>
                            <tr>
                                <th colspan="1">N.</th>
                                <th colspan="1" class="ln-counter">0</th>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                <div id="double-params">
                    <div class="data-title">
                        <p title="Titulo do dado" class="graphic_type" contenteditable><i>...</i></p>
                    </div>

                    <div id="data-input2">
                        <span>
                            <label for="x_axis">Eixo X:</label>
                            <input type="number" name="x_axis" id="x_axis" placeholder="Ex. 123" />
                        </span><br />
                        <span>
                            <label for="y_axis">Eixo Y:</label>
                            <input type="number" name="y_axis" id="y_axis" placeholder="Ex. 123" />
                        </span>
                        <button type="button" class="add-data-btn b2">Adicionar!</button>
                    </div>

                    <table>
                        <table>
                            <thead>
                                <tr>
                                    <th colspan="3">Dados inseridos:</th>
                                </tr>
                                <tr>
                                    <th>N.</th>
                                    <th>Eixo X:</th>
                                    <th>Eixo Y:</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                            <tfoot>
                                <tr>
                                    <th colspan="2">N.</th>
                                    <th colspan="1" class="ln-counter">0</th>
                                </tr>
                            </tfoot>
                        </table>
                    </table>
                </div>
            
                <button>Concluir!</button>
            </form>
        </div>
    </div>

    <script>
        class App {
            constructor() {
                this.data_types = [
                    "(D) Calculo de media",
                    "(D) Calculo de total",
                    "(D) Calculo de minimo",
                    "(D) Calculo de maximo",
                    "(D) Conte os dados",
                    "(D) Conte os dados distintos",
                    "(G) Grafico de barras",
                    "(G) Grafico de linhas"
                ]
            }

            updateTable() {
                const rows = document.querySelectorAll("table tr")

                rows.forEach(r => {
                    const cols = r.querySelectorAll(".el")

                    if (cols.length < 3) // 1 ou 2
                        if (cols.length < 2) // 1
                            cols[0].setAttribute("colspan", 3)
                        else // 2
                            cols[0].setAttribute("colspan", 2)
                })
            }

            async update() {
                await this.data_types.forEach((type, index) => {
                    const option = document.createElement("option")

                    option.innerHTML = type
                    option.setAttribute("value", index)

                    document.getElementById("el_selector").appendChild(option)
                })

                app.updateTable();
            }

            modalHandler() {
                const modal = document.getElementById("modal-bg")

                if (!modal.classList.contains("active"))
                    modal.classList.add("active")
                else
                    modal.classList.remove("active")
            }

            addData(type) {
                const table = document.querySelector("div.sel table tbody")
                const ln = document.createElement("tr") // create a table line
                const counter = document.querySelector("div.sel table .ln-counter") // gets the ref to line counter
                const Td = () => document.createElement("td")

                if(type == 1){
                    counter.innerHTML = Number(counter.innerHTML) + 1 // add 1 in to the counter
                    
                    const ntd = Td()
                    ntd.innerHTML = counter.innerHTML // insert the column id
                    ln.appendChild(ntd) // insert the column into the line
                    
                    const td = Td()
                    td.innerHTML = document.getElementById("1param_i").value // column with value
                    ln.appendChild(td) // insert the column into the line

                    table.appendChild(ln) // insert the line inside table
                }
                else if(type == 2){
                    counter.innerHTML = Number(counter.innerHTML) + 1 // add 1 in to the counter
                    
                    const ntd = Td()
                    ntd.innerHTML = counter.innerHTML // insert the column id
                    ln.appendChild(ntd) // insert the column into the line

                    const xtd = Td()
                    xtd.innerHTML = document.getElementById("x_axis").value // column with value x
                    ln.appendChild(xtd) // insert the column into the line

                    const ytd = Td()
                    ytd.innerHTML = document.getElementById("y_axis").value // column with value y
                    ln.appendChild(ytd) // insert the column into the line

                    table.appendChild(ln) // insert the line inside table
                }
                else
                    throw new Error("Unexpected error has occured!")
            }
        }

        const app = new App();
        app.update();

        // Open modal
        document.getElementById("addElement").addEventListener("click", app.modalHandler)
        document.getElementById("modal-bg").addEventListener("click", event => {
            if (event.target.id == "modal-bg")
                app.modalHandler()
        })

        // Update modal according to selector
        document.getElementById("el_selector").addEventListener("change", event => {
            const value = event.target.value

            const notSelected = document.getElementById("not-selected")
            const singleP = document.getElementById("single-param")
            const doubleP = document.getElementById("double-params")

            let type
            app.data_types.forEach((data_type, index) => {
                if (index == value)
                    type = data_type
            })

            if (value == -1) {
                notSelected.classList.add("sel")
                singleP.classList.remove("sel")
                doubleP.classList.remove("sel")
            } else {
                if (type.charAt(1) == "D") {
                    notSelected.classList.remove("sel")
                    singleP.classList.add("sel")
                    doubleP.classList.remove("sel")
                } else {
                    notSelected.classList.remove("sel")
                    singleP.classList.remove("sel")
                    doubleP.classList.add("sel")
                }
            }

            document.querySelector("div.sel .data-title .graphic_type").innerHTML = type.substring(3, type.length).trim()
        })

        for(const btn of document.getElementsByClassName("add-data-btn")){
            btn.addEventListener("click", event => {
                event.preventDefault()

                app.addData(btn.classList.contains("b1") ? 1 : 2)
            })
        }
    </script>


</body>
</html>
